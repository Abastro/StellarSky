#version 120

uniform sampler2D texture;
uniform float brScale;

vec4 encode(vec4 color) {
    float alpha = min(max(max(color.r, 0.0001), max(color.g, color.b)), 10000.0);
    color /= alpha;
    color.a = alpha;
    return color;
}

vec4 decode(vec4 color) {
    color *= color.a;
    color.a = 1.0;
    return color;
}

void main()
{
    vec4 fragColor = decode(texture2D(texture, gl_TexCoord[0].st));
    gl_FragColor = encode(fragColor / brScale);
}